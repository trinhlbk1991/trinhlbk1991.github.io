<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Android Dependency Injection using Dagger2 | Iced Tea Labs</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Iced Tea Labs"><meta name="application-name" content="Iced Tea Labs"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-48722139-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-48722139-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/ic_iced_tea_labs.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Iced Tea Labs</a></div><div class="site-subtitle">Glasses üëì Geek üíª Backpacker üéí Climber üßó‚Äç‚ôÇÔ∏è</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/trinhlbk1991" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/trinhlbk1991" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['trinhlbk1991','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/trinhlbk1991/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/categories/android/"> Android </a> </span> <span>Android Dependency Injection using Dagger2</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Android Dependency Injection using Dagger2</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Trinh Le </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, May 9, 2016, 2:57 PM +0700" prep="on" > May 9, 2016 <i class="unloaded">2016-05-09T14:57:00+07:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Aug 1, 2021, 12:42 PM +0700" prefix="Updated " > Aug 1, 2021 <i class="unloaded">2021-08-01T12:42:30+07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1384 words">7 min</span></div></div><div class="post-content"><h2>1 - What is Dependency Injection?</h2><p>Dependency Injection is a design pattern which help us to reduce the coupling between modules (classes). Hence, that makes our modules reusable, interchangeable and easy to test.</p><p>For example, in our Android app (more specifically, in <b>LoginActivity</b>), we must hit the authentication endpoint via <b>AuthenticationApi</b> to verify if user information is correct.</p><h3>1.1 - Not using DI</h3><p>This is the <b>AuthenticationApi</b> class, which will contact the server and verify input credentials:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IAuthenticationApi</span> <span class="o">{</span>

    <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Authentication</span><span class="o">&gt;</span> <span class="nf">authentication</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">);</span>

<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthenticationApi</span> <span class="kd">implements</span> <span class="nc">IAuthenticationApi</span><span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Authentication</span><span class="o">&gt;</span> <span class="nf">authentication</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Do a lot of stuff here like hitting server with provided auth info</span>
        <span class="k">return</span> <span class="nc">Observable</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><p>Then, inside <b>LoginActivity</b>, we instantiate new <b>AuthenticationApi</b> in <b>onCreate()</b> method.</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginActivity</span> <span class="kd">extends</span> <span class="nc">Activity</span> <span class="kd">implements</span> <span class="nc">OnClickListener</span><span class="o">{</span>

    <span class="kd">private</span> <span class="nc">AuthenticationApi</span> <span class="n">mAuthenticationApi</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
        <span class="c1">//Init view and do other stuffs</span>
        <span class="n">mAuthenticationApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AuthenticationApi</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mAuthenticationApi</span><span class="o">.</span><span class="na">authentication</span><span class="o">(</span><span class="n">mEtUsername</span><span class="o">.</span><span class="na">getText</span><span class="o">(),</span> <span class="n">mPassword</span><span class="o">.</span><span class="na">gettext</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><p>This cause a strong couple between <b>LoginActivity</b> and <b>AuthenticationApi</b> which is not really good. Like:</p><ul><li>What if we want to add a Logger in <b>IAuthenticationApi</b> when running debug but not release version?<li>What if we want <b>IAuthenticationApi</b> return mock data when running test?<li>What if in demo version, we want <b>IAuthenticationApi</b> retrieves data from local database instead of server?</ul><p>This is where <b>Dependency Injection</b> jump into the picture!</p><h3>1.2 - Using DI</h3><p>In <b>Dependency Injection</b> pattern, we usually have a <b>Factory</b> class which provides all the dependencies for the module/application.</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApiFactory</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nc">IAuthenticationApi</span> <span class="nf">getAuthenticationApi</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">AuthenticationApi</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><p>Then, inside Application class, we create a new instance of <b>ApiFactory</b> and expose public method to refer to. By this way, we can access the <b>ApiFactory</b> throughough entire application:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApplication</span> <span class="kd">extends</span> <span class="nc">Application</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">ApiFactory</span> <span class="n">mApiFactory</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setApiFactory</span><span class="o">(</span><span class="nc">ApiFactory</span> <span class="n">apiFactory</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mApiFactory</span> <span class="o">=</span> <span class="n">apiFactory</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="nc">ApiFactory</span> <span class="nf">getApiFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mApiFactory</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><p>Inside <b>LoginActivity</b>, we can easily refer to <b>ApiFactory</b> to get the <b>IAuthenticationApi</b> object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginActivity</span> <span class="kd">extends</span> <span class="nc">Activity</span> <span class="kd">implements</span> <span class="nc">OnClickListener</span><span class="o">{</span>

    <span class="kd">private</span> <span class="nc">IAuthenticationApi</span> <span class="n">mAuthenticationApi</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
        <span class="c1">//Init view and do other stuffs</span>
        <span class="n">mAuthenticationApi</span> <span class="o">=</span> <span class="o">((</span><span class="nc">MyApplication</span><span class="o">)</span> <span class="n">getApplication</span><span class="o">()).</span><span class="na">getApiFactory</span><span class="o">().</span><span class="na">getAuthenticationApi</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mAuthenticationApi</span><span class="o">.</span><span class="na">authentication</span><span class="o">(</span><span class="n">mEtUsername</span><span class="o">.</span><span class="na">getText</span><span class="o">(),</span> <span class="n">mPassword</span><span class="o">.</span><span class="na">gettext</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><p>As you can see, by using DI, now the <b>LoginActivity</b> does not depend on the <b>AuthenticationApi</b> anymore! Basically, <b>LoginActivity</b> doesn‚Äôt know the concrete implementation of <b>IAuthenticationApi</b>, the type of <b>IAuthenticationApi</b> was decided by the <b>ApiFactory</b>.</p><p>By having multiple <b>ApiFactory</b> based on build type, you can easily decide the concrete implementation of <b>IAuthenticationApi</b> in each case.</p><h3>1.3 - Conclusion</h3><p>After 2 examples above, DI is quite simple, right?! But if DI is simple, why do we need a framework?</p><p>Basically, the technique of DI is simple. But if your project is quite big, you have so many modules depend on each others, the dependencies will become more complicated. And it also produce a lot of boilerplate code which is not so beautiful!</p><h2>2 - Dagger2 Introduction</h2><h3>2.1 - What is Dagger2?</h3><p>Dagger2 is a fully static, compile-time dependency injection framework for both Java and Android. It is an adaptation of an earlier version created by Square and now maintained by Google.</p><h3>2.2 - Why using Dagger2?</h3><p>Traceability</p><ul><li>Easy to navigate around the entire project using <b>Find Usages‚Ä¶</b> and <b>Open Declaration</b><li>Trace through the code that clear and well structured</ul><p>Clarify API</p><ul><li>Simpler @Module declarations<li>Injections will fail at runtime if not correctly configured, which helps you find mistakes faster</ul><p>Performance</p><ul><li>No performance hit because injections are not performed using relfection like other dependency injection frameworks</ul><h2>3 - How to use Dagger2?</h2><h3>3.1 - Set Up</h3><p>Add following plugin and dependencies into app scope <b>build.gradle</b> file:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">apply</span> <span class="nl">plugin:</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">neenbedankt</span><span class="o">.</span><span class="na">android</span><span class="o">-</span><span class="n">apt</span><span class="err">'</span>

<span class="n">buildscript</span> <span class="o">{</span>
  <span class="n">repositories</span> <span class="o">{</span>
    <span class="n">jcenter</span><span class="o">()</span>
  <span class="o">}</span>
  <span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">classpath</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">neenbedankt</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">plugins</span><span class="o">:</span><span class="n">android</span><span class="o">-</span><span class="nl">apt:</span><span class="mf">1.4</span><span class="err">'</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="n">android</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">apt</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">dagger</span><span class="o">:</span><span class="n">dagger</span><span class="o">-</span><span class="nl">compiler:</span><span class="mf">2.0</span><span class="err">'</span>
  <span class="n">compile</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">dagger</span><span class="o">:</span><span class="nl">dagger:</span><span class="mf">2.0</span><span class="err">'</span>
  <span class="n">provided</span> <span class="err">'</span><span class="n">javax</span><span class="o">.</span><span class="na">annotation</span><span class="o">:</span><span class="n">jsr250</span><span class="o">-</span><span class="nl">api:</span><span class="mf">1.0</span><span class="err">'</span>

  <span class="o">...</span>
<span class="o">}</span></code></pre></figure><h3>3.2 - Define Module class</h3><p>Module classes is where you define all the dependencies provider for your application. You can have many Module classes in your project.</p><p>For example, below is the Android Module class which provides all the main Android objects so you can easily inject later:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Module</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AndroidModule</span> <span class="o">{</span>

    <span class="nd">@Provides</span>
    <span class="nd">@Singleton</span>
    <span class="nc">Context</span> <span class="nf">provideAppContext</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">DemoDagger2Application</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getApplicationContext</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Provides</span>
    <span class="nc">SharedPreferences</span> <span class="nf">provideDefaultSharedPreferences</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">PreferenceManager</span><span class="o">.</span><span class="na">getDefaultSharedPreferences</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Provides</span>
    <span class="nc">AccountManager</span> <span class="nf">provideAccountManager</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">AccountManager</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Provides</span>
    <span class="nc">NotificationManager</span> <span class="nf">provideNotificationManager</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="nc">NotificationManager</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="nc">Context</span><span class="o">.</span><span class="na">NOTIFICATION_SERVICE</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><p>Or another example below - ApiModule, which provides all Api related object for the application:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Module</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApiModule</span> <span class="o">{</span>

    <span class="nd">@Provides</span>
    <span class="nd">@Singleton</span>
    <span class="nc">AuthenticationApi</span> <span class="nf">provideAuthenticationApi</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">AuthenticationApi</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><p>When you declare a <b>@Singleton</b> annotation, Dagger2 will manage all the concurrency and make sure return the same object everytime for you. You don‚Äôt need to care about that anymore! Cool huh?</p><h3>3.3 - Declare Components</h3><p>Component interfaces is where you declare the association between Module and the Injection Target. In other words, the Component interfaces told Dagger2 that dependencies in specific Module will be used in listed classes.</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Singleton</span>
<span class="nd">@Component</span><span class="o">(</span><span class="n">modules</span> <span class="o">=</span> <span class="o">{</span><span class="nc">AndroidModule</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ApiModule</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MyComponent</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">inject</span><span class="o">(</span><span class="nc">LoginActivity</span> <span class="n">activity</span><span class="o">);</span>

     <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Initializer</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="nc">MyComponent</span> <span class="nf">init</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">mockMode</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nc">DaggerMyComponent</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">androidModule</span><span class="o">(</span><span class="k">new</span> <span class="nc">AndroidModule</span><span class="o">())</span>
                <span class="o">.</span><span class="na">apiModule</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApiModule</span><span class="o">())</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>By the way, in case you didn‚Äôt notice, the DaggerMyComponent was auto generated by Dagger2 after you build the project. And all the method like <b>androidModule()</b> was also auto generated based on your Module class name.</p><h3>3.4 - Instantiate the Component in Application class</h3><p>Next, inside your application class, instantiate the Component you just declare above:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApplication</span> <span class="kd">extends</span> <span class="nc">Application</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">MyApplication</span> <span class="n">mInstance</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">MyComponent</span> <span class="n">mComponent</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
        <span class="n">mInstance</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="n">mComponent</span> <span class="o">=</span> <span class="n">mComponent</span> <span class="o">=</span> <span class="nc">MyComponent</span><span class="o">.</span><span class="na">Initializer</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>   
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">MyApplication</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mInstance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">MyComponent</span> <span class="nf">getComponent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mComponent</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><h3>3.5 - Injection</h3><p>Now you can inject the dependency that you need inside any classes you declared in the Component by simply using the annotation @Inject. And before using any Injected instance, remember to call the inject() method of Component:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">DemoDagger2Application</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getComponent</span><span class="o">().</span><span class="na">inject</span><span class="o">(</span><span class="k">this</span><span class="o">);</span></code></pre></figure><p>Sample code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginActivity</span> <span class="kd">extends</span> <span class="nc">Activity</span> <span class="kd">implements</span> <span class="nc">OnClickListener</span><span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">protected</span> <span class="nc">AuthenticationApi</span> <span class="n">mAuthenticationApi</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="nc">MyApplication</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getComponent</span><span class="o">().</span><span class="na">inject</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mAuthenticationApi</span><span class="o">.</span><span class="na">authentication</span><span class="o">(</span><span class="n">mEtUsername</span><span class="o">.</span><span class="na">getText</span><span class="o">(),</span> <span class="n">mPassword</span><span class="o">.</span><span class="na">gettext</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><h2>4 - Instrumentation Testing with Dagger, Mockito, and Espresso</h2><p>In instrumentation test, we usually mock the server response to make sure the test suite can cover every cases from succeed to fail.</p><p>In this part of the post, I‚Äôll show you how to write instrumentation tests with Dagger, Mockito and Espresso.</p><p>Beside the official <b>ApiModule</b> which will be applied for release build, we also need a <b>DebugApiModule</b> for the debug build. This module will decide to return the real or mock object base on the mock mode:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Module</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DebugApiModule</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">mIsMockMode</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">DebugApiModule</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">isMockMode</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mIsMockMode</span> <span class="o">=</span> <span class="n">isMockMode</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Provides</span>
    <span class="nd">@Singleton</span>
    <span class="nc">AuthenticationApi</span> <span class="nf">provideAuthenticationApi</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">mIsMockMode</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nc">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="nc">AuthenticationApi</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">AuthenticationApi</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><p>Under the <b>debug</b> code base directory, we create another <b>MyComponent</b> class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Singleton</span>
<span class="nd">@Component</span><span class="o">(</span><span class="n">modules</span> <span class="o">=</span> <span class="o">{</span><span class="nc">AndroidModule</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">DebugApiModule</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MyComponent</span> <span class="o">{</span>
     <span class="kt">void</span> <span class="nf">inject</span><span class="o">(</span><span class="nc">LoginActivity</span> <span class="n">activity</span><span class="o">);</span>

     <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Initializer</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="nc">MyComponent</span> <span class="nf">init</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">mockMode</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nc">DaggerMyComponent</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">androidModule</span><span class="o">(</span><span class="k">new</span> <span class="nc">AndroidModule</span><span class="o">())</span>
                <span class="o">.</span><span class="na">debugApiModule</span><span class="o">(</span><span class="k">new</span> <span class="nc">DebugApiModule</span><span class="o">(</span><span class="n">mockMode</span><span class="o">))</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>You can notice that, instead of using <b>ApiModule</b> we will you <b>DebugApiModule</b> this time.</p><p>Then, we modify the Application class to expose a method to set the mock mode:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApplication</span> <span class="kd">extends</span> <span class="nc">Application</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">MyApplication</span> <span class="n">mInstance</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">MyComponent</span> <span class="n">mComponent</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
        <span class="n">mInstance</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
        <span class="n">mComponent</span> <span class="o">=</span> <span class="nc">MyComponent</span><span class="o">.</span><span class="na">Initializer</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">MyApplication</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mInstance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">MyComponent</span> <span class="nf">getComponent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mComponent</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMockMode</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">useMock</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mComponent</span> <span class="o">=</span> <span class="nc">MyComponent</span><span class="o">.</span><span class="na">Initializer</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><p>Now, in test class (below is the code of <b>BaseActivityTest</b> which will be extended later), we can easily switching between mock and real mode:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BaseActivityTest</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="nc">AuthenticationApi</span> <span class="n">mMockAuthenticationApi</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">setUp</span><span class="o">();</span>
        <span class="nc">MyApplication</span> <span class="n">app</span> <span class="o">=</span> <span class="o">(</span><span class="nc">MyApplication</span><span class="o">)</span> <span class="n">getInstrumentation</span><span class="o">().</span><span class="na">getTargetContext</span><span class="o">().</span><span class="na">getApplicationContext</span><span class="o">();</span>
        <span class="n">app</span><span class="o">.</span><span class="na">setMockMode</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">app</span><span class="o">.</span><span class="na">getComponent</span><span class="o">().</span><span class="na">inject</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">tearDown</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">App</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">setMockMode</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><h2>5 - Sample Code</h2><p>So, that‚Äôs all for Dagger2 in this post.</p><p>You can find the full sample source code on my Github page.</p><p>In later posts, I‚Äôll cover some advance topics of Dagger2.</p><p>Hope you enjoy it! :D</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/android/'>android</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/dagger2/" class="post-tag no-text-decoration" >Dagger2</a> <a href="/tags/design-pattern/" class="post-tag no-text-decoration" >Design Pattern</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Android Dependency Injection using Dagger2 - Iced Tea Labs&url=https://icedtealabs.com//android/android-dependency-injection-using-dagger2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Android Dependency Injection using Dagger2 - Iced Tea Labs&u=https://icedtealabs.com//android/android-dependency-injection-using-dagger2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Android Dependency Injection using Dagger2 - Iced Tea Labs&url=https://icedtealabs.com//android/android-dependency-injection-using-dagger2/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Our Products</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="https://play.google.com/store/apps/details?id=com.icetea09.bucketlist"><div class="d-flex align-items-center"> <img src="/assets/images/buckist.png" width="50" height="50" /><div><strong>Buckist</strong> - Best bucket list app</div></div></a> <a class="post-tag" href="https://play.google.com/store/apps/details?id=com.icedtealabs.mymoney"><div class="d-flex align-items-center"> <img src="/assets/images/mymoney.png" width="50" height="50" /><div><strong>myMoney</strong> - Expense Manager</div></div></a> <a class="post-tag" href="https://play.google.com/store/apps/details?id=com.icedtealabs.moon"><div class="d-flex align-items-center"> <img src="https://play-lh.googleusercontent.com/fh1U3sqmhbWWRiS6fjh4caslBlE86ZlJBgucayR5wko743aM_U143sHPLTVZvJuHZA=s360-rw" width="50" height="50" /><div><strong>Moon</strong> - Blue light filter, night mode</div></div></a></div></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android-ui/">Android UI</a> <a class="post-tag" href="/tags/custom-view/">Custom View</a> <a class="post-tag" href="/tags/animation/">Animation</a> <a class="post-tag" href="/tags/android-database/">Android Database</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/dependency-injection/">Dependency Injection</a> <a class="post-tag" href="/tags/facebook/">Facebook</a> <a class="post-tag" href="/tags/fragment/">Fragment</a> <a class="post-tag" href="/tags/hilt/">Hilt</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/android/design-pattern-singleton-implementation/"><div class="card-body"> <span class="timeago small" > May 12, 2014 <i class="unloaded">2014-05-12T15:36:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Singleton Implementation</h3><div class="text-muted small"><p> A - Intent Ensure only ONE instance of the class is created Provide global access to that instance B - Usage Singleton will be applied when you want to have exactly ONE instance of a class, no ...</p></div></div></a></div><div class="card"> <a href="/android/android-apply-mvp-pattern-for-android/"><div class="card-body"> <span class="timeago small" > Nov 10, 2014 <i class="unloaded">2014-11-10T17:29:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Apply MVP Pattern for Android</h3><div class="text-muted small"><p> A - What is MVP? MVP pattern stands for Model - View - Presenter. MVP is a derivative from famous MVC guy. It allows separate the presentation layer from¬†the business logic. - ¬† Model:¬†handle pers...</p></div></div></a></div><div class="card"> <a href="/android/android-rxjava-introduction/"><div class="card-body"> <span class="timeago small" > Jul 27, 2017 <i class="unloaded">2017-07-27T11:34:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>RxJava Introduction</h3><div class="text-muted small"><p> What is RxJava? Quoted from RxJava home page: RxJava is a Java VM implementation of Reactive Extensions: a library for composing asynchronous and event-based programs by using observable seque...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/android/android-instrumentation-test-using-espresso/" class="btn btn-outline-primary" prompt="Older"><p>Android Instrumentation Test Using Espresso</p></a> <a href="/privacy-policy/buckist-privacy-policy/" class="btn btn-outline-primary" prompt="Newer"><p>Buckist Privacy Policy</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//icetea09.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Android Dependency Injection using Dagger2'; this.page.url = 'https://icedtealabs.com//android/android-dependency-injection-using-dagger2/'; this.page.identifier = '/android/android-dependency-injection-using-dagger2/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> ¬© 2025 <a href="https://twitter.com/trinhlbk1991">Trinh Le</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android-ui/">Android UI</a> <a class="post-tag" href="/tags/custom-view/">Custom View</a> <a class="post-tag" href="/tags/animation/">Animation</a> <a class="post-tag" href="/tags/android-database/">Android Database</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/dependency-injection/">Dependency Injection</a> <a class="post-tag" href="/tags/facebook/">Facebook</a> <a class="post-tag" href="/tags/fragment/">Fragment</a> <a class="post-tag" href="/tags/hilt/">Hilt</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://icedtealabs.com/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
