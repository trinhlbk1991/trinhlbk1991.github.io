---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { SITE } from '../../config';
import { getPostsByLang, parsePostId } from '../../utils/content';
import { useTranslations } from '../../utils/i18n';

interface Props {
  lang: 'en' | 'vi';
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const posts = await getPostsByLang(lang);
const latestPosts = posts
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 6);

const langPrefix = lang === 'en' ? '' : `/${lang}`;
---

<BaseLayout 
  title={`Home | ${SITE.title}`}
  description={SITE.description}
  lang={lang}
>
  <div class="relative overflow-hidden">
    <!-- Decorative background element -->
    <div class="absolute -top-24 -right-24 w-96 h-96 bg-primary-light rounded-full blur-3xl opacity-30 -z-10"></div>
    
    <div class="max-w-5xl mx-auto px-6 py-24 lg:py-32">
      <!-- Hero -->
      <section class="text-center mb-24 relative">
        <span class="text-primary font-medium tracking-wider uppercase text-sm mb-4 block">
          {t('home.welcome')} {SITE.title}
        </span>
        <h1 class="text-5xl md:text-6xl text-content mb-6 font-bold">
          Technical <span class="text-primary">Insights</span><br />
          for Modern Developers
        </h1>
        <p class="text-xl text-content-muted max-w-2xl mx-auto mb-10">
          Exploring Android, iOS, frontend development, and everything in between. 
          A geek's journey through code, climbing, and continuous learning.
        </p>
        <div class="flex justify-center gap-4 flex-wrap">
          <a href={`${langPrefix}/archives`} class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors inline-flex items-center gap-2 font-medium">
            Browse Articles
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>
      </section>
  
      <!-- Latest Posts -->
      {latestPosts.length > 0 && (
        <section>
          <div class="flex items-end justify-between mb-10">
            <h2 class="text-3xl font-bold text-content">{t('home.latest')}</h2>
            <a href={`${langPrefix}/archives`} class="text-primary font-medium hover:text-primary-hover transition-colors flex items-center gap-1">
              {t('home.viewAll')}
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </a>
          </div>
          
          <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
            {latestPosts.map((post) => {
              const { category, slug } = parsePostId(post.id);
              
              return (
                <article class="border border-surface-3 rounded-lg overflow-hidden hover:shadow-lg transition-shadow duration-200 group bg-surface-1">
                  {post.data.image && (
                    <div class="aspect-[16/9] bg-surface-2 relative overflow-hidden">
                      <img 
                        src={post.data.image} 
                        alt={post.data.title}
                        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                      />
                    </div>
                  )}
                  <div class="p-6">
                    <div class="flex items-center gap-3 text-sm text-content-muted mb-3">
                      <time datetime={post.data.date.toISOString()}>
                        {post.data.date.toLocaleDateString(lang === 'vi' ? 'vi-VN' : 'en-US', { 
                          year: 'numeric', 
                          month: 'short', 
                          day: 'numeric' 
                        })}
                      </time>
                      {post.data.categories && post.data.categories.length > 0 && (
                        <>
                          <span>â€¢</span>
                          <span class="px-2 py-1 bg-primary-light text-primary-hover rounded text-xs capitalize font-medium">
                            {post.data.categories[0]}
                          </span>
                        </>
                      )}
                    </div>
                    <a href={`${langPrefix}/${category}/${slug}/`}>
                      <h3 class="text-xl font-bold text-content group-hover:text-primary transition-colors mb-3">
                        {post.data.title}
                      </h3>
                    </a>
                    {(post.data.summary || post.data.description) && (
                      <p class="text-content-muted line-clamp-2">
                        {post.data.summary || post.data.description}
                      </p>
                    )}
                  </div>
                </article>
              );
            })}
          </div>
        </section>
      )}
    </div>
  </div>
</BaseLayout>
