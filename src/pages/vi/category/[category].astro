---
import CategoryPage from '../../../components/pages/CategoryPage.astro';
import { getPostsByLang, parsePostId } from '../../../utils/content';

export const prerender = true;

export async function getStaticPaths() {
  const blogEntries = await getPostsByLang('vi');
  
  // Get all unique categories
  const categories = new Set<string>();
  blogEntries.forEach((entry) => {
    const { category } = parsePostId(entry.id);
    categories.add(category);
  });
  
  // Generate a path for each category
  return Array.from(categories).map((category) => {
    const categoryPosts = blogEntries.filter((entry) => {
      const { category: entryCategory } = parsePostId(entry.id);
      return entryCategory === category;
    });
    
    // Sort by date (newest first)
    const sortedPosts = categoryPosts.sort((a, b) => 
      b.data.date.valueOf() - a.data.date.valueOf()
    );
    
    return {
      params: { category },
      props: { 
        posts: sortedPosts,
        category,
      },
    };
  });
}

const { posts, category } = Astro.props;
---

<CategoryPage posts={posts} category={category} lang="vi" />
