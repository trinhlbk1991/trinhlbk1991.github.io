---
import { getCollection } from 'astro:content';
import PrivacyPolicyPostPage from '../../components/pages/PrivacyPolicyPostPage.astro';
import { SITE } from '../../config';

export const prerender = true;

export async function getStaticPaths() {
  const privacyEntries = await getCollection('privacy-policy');
  
  return privacyEntries.map((entry) => {
    // Extract slug from filename (e.g., '2024-07-24-persona-peek-privacy-policy.md' -> 'persona-peek-privacy-policy')
    const slug = entry.id.replace(/^\d{4}-\d{2}-\d{2}-/, '').replace(/\.md$/, '');
    
    return {
      params: { slug },
      props: { entry },
    };
  });
}

const { entry } = Astro.props;

// SEO metadata
const pageTitle = `${entry.data.title} | ${SITE.title}`;
const pageDescription = entry.data.description || entry.data.title;
const pageImage = entry.data.image || `${SITE.url}/og-image.png`;
const canonicalURL = `${SITE.url}/privacy-policy/${Astro.params.slug}/`;

// JSON-LD structured data for SEO
const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'WebPage',
  name: entry.data.title,
  description: pageDescription,
  url: canonicalURL,
  publisher: {
    '@type': 'Organization',
    name: SITE.title,
    url: SITE.url,
  },
};
---

<PrivacyPolicyPostPage entry={entry} lang="en" />