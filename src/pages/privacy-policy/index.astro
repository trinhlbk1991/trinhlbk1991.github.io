---
import { getCollection } from 'astro:content';
import { SITE } from '../../config';
import PrivacyPolicyPage from '../../components/pages/PrivacyPolicyPage.astro';

export const prerender = true;

// Get all privacy policy entries
const privacyEntries = await getCollection('privacy-policy');

// Sort by filename (which contains the date)
const sortedEntries = privacyEntries.sort((a, b) => {
  return b.id.localeCompare(a.id);
});

// Group entries by app name (extracted from filename)
const groupedEntries = sortedEntries.reduce((acc, entry) => {
  const slug = entry.id.replace(/^\d{4}-\d{2}-\d{2}-/, '').replace(/\.md$/, '');
  const appName = slug.split('-')[0]; // Get first word (e.g., 'persona', 'sudoku', 'mymoney')
  
  if (!acc[appName]) {
    acc[appName] = [];
  }
  acc[appName].push({
    ...entry,
    slug: slug,
  });
  
  return acc;
}, {} as Record<string, Array<any>>);

// SEO metadata
const pageTitle = `Privacy Policies & Terms | ${SITE.title}`;
const pageDescription = 'Privacy policies and terms of service for all our mobile applications';
const canonicalURL = `${SITE.url}/privacy-policy/`;
---

<PrivacyPolicyPage lang="en" />