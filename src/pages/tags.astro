---
import TagsPage from '../components/pages/TagsPage.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');

// Extract and count tags
const tagData = {};
posts.forEach(post => {
  if (post.data.tags && post.data.tags.length > 0) {
    post.data.tags.forEach(tag => {
      if (!tagData[tag]) {
        tagData[tag] = {
          count: 0,
          posts: []
        };
      }
      tagData[tag].count++;
      tagData[tag].posts.push(post);
    });
  }
});

const tags = Object.keys(tagData).sort();
const totalPosts = posts.length;
const totalTags = tags.length;

// Calculate tag popularity for sizing
const maxCount = Math.max(...Object.values(tagData).map(tag => tag.count));
const minCount = Math.min(...Object.values(tagData).map(tag => tag.count));

function getTagSize(count) {
  if (maxCount === minCount) return 'text-base';
  const ratio = (count - minCount) / (maxCount - minCount);
  if (ratio >= 0.75) return 'text-xl font-bold';
  if (ratio >= 0.5) return 'text-lg font-semibold';
  if (ratio >= 0.25) return 'text-base font-medium';
  return 'text-sm';
}

function getTagColor(count) {
  if (maxCount === minCount) return 'bg-primary-light text-primary-hover border-primary-light';
  const ratio = (count - minCount) / (maxCount - minCount);
  if (ratio >= 0.75) return 'bg-primary text-white border-primary';
  if (ratio >= 0.5) return 'bg-primary text-white border-primary';
  if (ratio >= 0.25) return 'bg-primary-light text-primary-hover border-primary-light';
  return 'bg-surface-2 text-content-muted border-surface-3';
}
---

<TagsPage lang="en" define:vars={{ tagData, tags, totalPosts, totalTags }} />