---
import CategoriesPage from '../components/pages/CategoriesPage.astro';
import { getCollection } from 'astro:content';
import { SITE } from '../config';

const posts = await getCollection('blog');

// Extract categories and count posts
const categoryData: Record<string, { count: number; latestPost: Date }> = {};

posts.forEach(post => {
  // Get category from folder structure (e.g., 'android/post.md' -> 'android')
  const category = post.id.split('/')[0];
  
  if (!categoryData[category]) {
    categoryData[category] = {
      count: 0,
      latestPost: post.data.date,
    };
  }
  
  categoryData[category].count++;
  
  // Track latest post date
  if (post.data.date > categoryData[category].latestPost) {
    categoryData[category].latestPost = post.data.date;
  }
});

// Convert to array and sort by post count (descending)
const categories = Object.entries(categoryData)
  .map(([name, data]) => ({ name, ...data }))
  .sort((a, b) => b.count - a.count);

const totalPosts = posts.length;
---

<CategoriesPage lang="en" />